---
icon: question
category:
  - Guide
tag:
  - annotations
  - aspects
---

# How to use

## <i class="fa fa-at"></i> 1. Create an annotation

:::code-tabs
@tab log-errors.annotation.ts

```ts
// Create an annotation
export const LogErrors = new AnnotationFactory('demo').create(function Log(
  level: 'info' | 'warn' | 'error' | 'debug' = 'error',
) {});
```

:::

> **info** An annotation is basically a TS decorator with no behavior.

## <i class="fa fa-layer-group"></i> 2. Create an aspect

:::code-tabs
@tab log-errors.aspect.ts

```ts
import { AfterThrow, AfterThrowContext, Aspect, on } from '@aspectjs/core';

@Aspect()
export class LogErrorsAspect {
  constructor(
    private readonly defaultLevel:
      | 'info'
      | 'warn'
      | 'error'
      | 'debug' = 'error',
  ) {}
  @AfterThrow(on.classes.withAnnotations(LogErrors))
  @AfterThrow(on.methods.withAnnotations(LogErrors))
  logAround(context: AfterThrowContext, error: Error) {
    // read the log level given in parameter to the `@LogErrors()` annotation
    const logAnnotation = context.annotations.filter(LogErrors).find()[0]!;
    const level = logAnnotation.args[0] ?? this.defaultLevel;
    console[level](
      `${context.target}(${context.args.join(',')}) throwed error ${error}`,
    );
    // Propagate the error
    throw error;
  }
}
```

:::

## <i class="fa fa-gears"></i> 3. Enable the aspect

:::code-tabs
@tab aop.config.ts

```ts
import { getWeaver } from '@aspectjs/core';

getWeaver().enable(new LogErrorsAspect());
```

:::

## <i class="fa fa-check"></i> 3. Use the aspect

:::code-tabs
@tab hello.ts

```ts
@LogErrors('warn')
export class Hello {
  hello: string;

  constructor(hello: string = 'hello') {
    this.hello = hello;
  }

  @LogErrors('warn')
  sayHello(who: string = 'world') {
    throw new Error(`${this.hello} ${who}`);
  }
}
```

:::
